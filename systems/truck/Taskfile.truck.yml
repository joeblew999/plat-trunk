version: '3'

# Truck is a Rust CAD Kernel library (https://github.com/ricosjp/truck)
# It's used as a Cargo dependency, not built as a standalone binary

vars:
  ROOT_DIR: '{{.ROOT_DIR | default "."}}'
  BIN_DIR: '{{.ROOT_DIR}}/.bin'
  SRC_DIR: '{{.ROOT_DIR}}/.src'
  DATA_DIR: '{{.ROOT_DIR}}/.data'
  TRUCK_SRC_DIR: '{{.SRC_DIR}}/truck'
  TRUCK_REPO: 'github.com/ricosjp/truck'

tasks:
  default:
    internal: true
    cmds:
      - task: debug:self

  "debug:self":
    desc: Print all vars for debugging
    cmds:
      - echo "=== Truck Vars ==="
      - echo "ROOT_DIR={{.ROOT_DIR}}"
      - echo "SRC_DIR={{.SRC_DIR}}"
      - echo "TRUCK_SRC_DIR={{.TRUCK_SRC_DIR}}"
      - echo "TRUCK_REPO={{.TRUCK_REPO}}"
    silent: true

  # Dependencies - clone for reference/examples
  "deps:clone":
    desc: Clone truck repo (for examples/reference)
    status:
      - test -d {{.TRUCK_SRC_DIR}}
    cmds:
      - mkdir -p {{.SRC_DIR}}
      - git clone --depth 1 https://{{.TRUCK_REPO}}.git {{.TRUCK_SRC_DIR}}

  "deps:clean":
    desc: Remove truck source
    cmds:
      - rm -rf {{.TRUCK_SRC_DIR}}

  # Run examples from the truck repo
  "examples:list":
    desc: List available truck examples
    deps: ["deps:clone"]
    cmds:
      - ls {{.TRUCK_SRC_DIR}}/truck-rendimpl/examples/ 2>/dev/null || echo "No examples found"

  "examples:run":
    desc: Run a truck example (usage - task truck:examples:run -- <example_name>)
    deps: ["deps:clone"]
    cmds:
      - cd {{.TRUCK_SRC_DIR}} && cargo run --example {{.CLI_ARGS}}
