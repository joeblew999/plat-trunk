version: '3'

vars:
  ROOT_DIR: '{{.ROOT_DIR | default "."}}'
  BIN_DIR: '{{.ROOT_DIR}}/.bin'
  EXE: '{{if eq OS "windows"}}.exe{{end}}'
  ENVSUBST_BIN: '{{.BIN_DIR}}/envsubst{{.EXE}}'
  ENVSUBST_VERSION: '${ENVSUBST_VERSION:-v1.4.2}'

tasks:
  default:
    internal: true
    cmds:
      - task: debug:self

  "debug:self":
    desc: Print all vars for debugging
    cmds:
      - echo "=== Envsubst Vars ==="
      - echo "ROOT_DIR={{.ROOT_DIR}}"
      - echo "BIN_DIR={{.BIN_DIR}}"
      - echo "ENVSUBST_BIN={{.ENVSUBST_BIN}}"
      - echo "ENVSUBST_VERSION={{.ENVSUBST_VERSION}}"
    silent: true

  "deps:install":
    desc: Install envsubst (Go version with extended features)
    status:
      - test -f {{.ENVSUBST_BIN}}
    cmds:
      - mkdir -p {{.BIN_DIR}}
      - GOBIN={{.BIN_DIR}} go install github.com/a8m/envsubst/cmd/envsubst@{{.ENVSUBST_VERSION}}

  "deps:clean":
    desc: Remove envsubst binary
    cmds:
      - rm -f {{.ENVSUBST_BIN}}
